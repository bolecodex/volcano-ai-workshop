# 智能搜索功能使用指南

## 📅 更新时间
2025年10月15日

## 🎯 功能概述

智能搜索是一个集成的多模态搜索页面，合并了原有的"智能搜图"和"向量检索"功能，基于火山引擎 VikingDB 向量数据库实现。

## ✨ 核心功能

### 1. 多种搜索模式

#### 文搜文/图/视频
- 使用文本描述搜索文本内容
- 使用文本描述搜索图片
- 使用文本描述搜索视频
- 适用场景：通过关键词或描述查找相关内容

#### 图搜图/视频
- 上传图片查找相似图片
- 上传图片查找相关视频
- 支持图片 URL 输入
- 适用场景：以图搜图、找相似内容

#### 视频搜索
- 上传视频查找相似视频
- 支持视频 URL 输入
- 适用场景：视频去重、相似视频推荐

#### 混合搜索
- 结合文本、图片、视频进行综合搜索
- 多模态输入提高搜索精度
- 适用场景：复杂的搜索需求

### 2. 灵活的配置选项

- **数据集配置**：指定 VikingDB 中的 Collection 和 Index
- **返回数量控制**：TopK 参数，控制返回结果数量（1-100）
- **输出字段定制**：指定返回哪些字段（f_text, f_image, f_video 等）
- **相似度排序**：结果按相似度分数自动排序

### 3. 搜索历史管理

- 自动记录每次搜索
- 显示搜索模式、数据集、查询内容
- 保留最近 20 条记录
- 支持清空历史

## 🚀 使用步骤

### 第一步：配置访问密钥

1. 进入"设置"页面
2. 配置 **AccessKeyId** 和 **SecretAccessKey**
3. 这些密钥用于访问 VikingDB 服务

### 第二步：准备数据集

在使用智能搜索之前，需要在 VikingDB 控制台完成以下准备：

1. **创建数据集（Collection）**
   - 登录火山引擎控制台
   - 进入 VikingDB 服务
   - 创建新的数据集
   - 记录数据集名称（如：`video_demo2`）

2. **创建索引（Index）**
   - 在数据集中创建索引
   - 配置向量字段
   - 记录索引名称（通常与数据集名称相同）

3. **导入数据**
   - 上传你的文本、图片或视频数据
   - 系统会自动生成向量表示
   - 确保数据包含必要的字段（f_text, f_image, f_video 等）

### 第三步：配置数据集信息

在智能搜索页面的"搜索"标签页：

1. 在"数据集配置"区域填入：
   - **数据集名称（Collection）**：如 `video_demo2`
   - **索引名称（Index）**：如 `video_demo2`
2. 配置会自动保存到本地

### 第四步：执行搜索

1. **选择搜索模式**
   - 点击对应的按钮选择搜索模式

2. **输入搜索内容**
   - 文本模式：在文本框中输入描述
   - 图片模式：上传图片或输入图片 URL
   - 视频模式：上传视频或输入视频 URL
   - 混合模式：可以同时输入多种类型

3. **设置搜索参数**
   - **返回数量（TopK）**：设置返回多少个结果（默认 10）
   - **输出字段**：指定返回哪些字段，用逗号分隔

4. **开始搜索**
   - 点击"开始搜索"按钮
   - 等待搜索完成
   - 查看搜索结果

### 第五步：查看结果

搜索结果会显示：
- **结果卡片**：包含图片/视频预览、文本内容
- **相似度分数**：用进度条可视化显示
  - 绿色（>80%）：非常相似
  - 蓝色（50-80%）：比较相似
  - 黄色（<50%）：相似度较低
- **操作按钮**：查看视频、下载等

## 🔧 配置说明

### 数据集字段

VikingDB 数据集通常包含以下字段：

| 字段名 | 类型 | 说明 |
|--------|------|------|
| `f_text` | String | 文本内容 |
| `f_image` | String | 图片 URL |
| `f_video` | String | 视频 URL |
| `f_vector` | Vector | 向量表示（系统自动生成） |
| `video_id` | String | 视频ID（可选） |
| `landscape_video` | String | 横屏视频（可选） |

### 输出字段配置

在"输出字段"设置中，可以指定返回哪些字段：

```
f_text, f_image, f_video, video_id
```

- 多个字段用逗号分隔
- 只返回你需要的字段可以提高查询速度
- 如果字段不存在，会被自动忽略

### 搜索参数优化

| 参数 | 建议值 | 说明 |
|------|--------|------|
| TopK（limit） | 10-20 | 一般用途 |
| TopK（limit） | 1-5 | 只需要最相似的几个 |
| TopK（limit） | 50-100 | 需要更多候选结果 |

## 📊 搜索模式详解

### 文搜文/图/视频

**使用场景**：
- 通过关键词查找相关内容
- 语义搜索，理解查询意图
- 跨模态搜索（文本查图片/视频）

**示例查询**：
```
石头
风景
跑步的人
蓝天白云
```

**返回结果**：
- 包含相关文本的数据
- 相关的图片
- 相关的视频片段

### 图搜图/视频

**使用场景**：
- 以图搜图，找相似图片
- 通过参考图找相关视频
- 图片去重
- 版权保护

**支持格式**：
- JPEG, PNG, WebP, BMP
- 支持上传或 URL
- 支持 TOS 地址：`tos://bucket/object`

**最佳实践**：
- 使用高质量、清晰的图片
- 图片主体明确
- 避免过度压缩

### 视频搜索

**使用场景**：
- 视频去重
- 相似视频推荐
- 内容审核

**支持格式**：
- MP4, AVI, MOV
- 文件大小限制：50MB
- 支持 TOS 地址

### 混合搜索

**使用场景**：
- 复杂的搜索需求
- 提高搜索精度
- 多维度筛选

**示例**：
```
文本：石头 + 图片：石头照片
文本：风景 + 视频：风景视频片段
```

## 🎯 最佳实践

### 1. 数据准备

- **文本数据**：确保文本描述准确、完整
- **图片数据**：使用高质量图片，避免模糊
- **视频数据**：确保视频格式正确，时长适中

### 2. 查询优化

- **文本查询**：使用关键词而非完整句子
- **图片查询**：使用清晰、主体明确的图片
- **视频查询**：使用代表性的视频片段

### 3. 结果筛选

- 根据相似度分数筛选结果
- 调整 TopK 参数获取更多候选
- 使用输出字段只返回需要的数据

### 4. 性能优化

- 限制返回字段数量
- 设置合理的 TopK 值
- 避免频繁重复查询

## ⚠️ 常见问题

### Q1: 返回 404 错误

**原因**：
- 数据集名称或索引名称错误
- 数据集不存在或未创建
- 没有权限访问该数据集

**解决方法**：
1. 检查数据集和索引名称是否正确
2. 在 VikingDB 控制台确认数据集存在
3. 检查 AccessKey 权限

### Q2: 搜索结果为空

**原因**：
- 数据集中没有匹配的数据
- 查询向量与数据库向量相似度太低
- 输出字段配置错误

**解决方法**：
1. 确认数据集中有数据
2. 调整查询内容或方式
3. 检查输出字段配置

### Q3: 相似度分数都很低

**原因**：
- 查询内容与数据库内容差异较大
- 向量模型不匹配
- 数据质量问题

**解决方法**：
1. 调整查询策略
2. 检查数据质量
3. 增加 TopK 值查看更多结果

### Q4: 搜索速度慢

**原因**：
- 数据集规模大
- 返回字段过多
- 网络延迟

**解决方法**：
1. 减少返回字段
2. 降低 TopK 值
3. 优化数据集索引

## 🔐 安全说明

### 访问密钥管理

- **AccessKeyId** 和 **SecretAccessKey** 存储在本地
- 不要泄露给他人
- 定期更换密钥
- 使用子账号分配最小权限

### 数据隐私

- 搜索查询数据不会被存储到云端
- 历史记录仅保存在本地浏览器
- 可随时清空历史记录

## 📈 使用示例

### 示例 1：查找相似图片

```
模式：图搜图/视频
数据集：image_collection
索引：image_index
输入：上传一张风景照片
TopK：10
输出字段：f_image, f_text

结果：返回 10 张相似的风景照片
```

### 示例 2：文本搜索视频

```
模式：文搜文/图/视频
数据集：video_demo2
索引：video_demo2
查询文本：石头
TopK：5
输出字段：f_video, f_text, f_image

结果：返回 5 个包含"石头"的视频
```

### 示例 3：混合搜索

```
模式：混合搜索
数据集：multimedia_collection
索引：multimedia_index
文本：夕阳
图片：上传夕阳照片
TopK：10
输出字段：f_image, f_video, f_text

结果：返回与夕阳相关的图片和视频
```

## 🔄 更新日志

### v1.0.0 (2025-10-15)
- ✅ 合并智能搜图和向量检索功能
- ✅ 支持文搜文/图/视频
- ✅ 支持图搜图/视频
- ✅ 支持视频搜索
- ✅ 支持混合搜索
- ✅ 自定义数据集和索引配置
- ✅ 搜索历史记录
- ✅ 详细的使用说明

## 📚 参考资料

- [VikingDB 向量数据库文档](https://www.volcengine.com/docs/84313/1211548)
- [多模态搜索 API](https://www.volcengine.com/docs/84313/1254554)
- [火山引擎控制台](https://console.volcengine.com/vikingdb)

## 💡 技术支持

如有问题或建议：
1. 查看本文档的常见问题部分
2. 查看 VikingDB 官方文档
3. 检查应用日志（Electron 开发者工具）
4. 联系技术支持

---

**版本**: v1.0.0  
**最后更新**: 2025年10月15日  
**状态**: ✅ 已完成并可用

