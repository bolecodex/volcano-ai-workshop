# 动作模仿任务列表功能

## 功能概述

动作模仿页面现已增加任务列表管理功能，用户可以方便地查看、管理和追踪所有的动作模仿任务。

## 主要功能

### 1. 标签页切换

页面分为两个标签页：
- **创建任务**：提交新的动作模仿任务
- **任务列表**：查看和管理历史任务

### 2. 任务历史记录

- ✅ 自动保存所有提交的任务到本地存储
- ✅ 显示任务总数统计
- ✅ 保留最近 100 个任务记录
- ✅ 按创建时间倒序排列

### 3. 任务信息展示

任务列表显示以下信息：

| 字段 | 说明 |
|------|------|
| 任务ID | 唯一标识符 |
| 状态 | 当前任务状态（排队中/生成中/已完成/失败等）|
| 创建时间 | 任务创建时间 |
| 更新时间 | 最后更新时间 |
| 预览图 | 输入图片的缩略图 |
| 操作 | 查看详情/刷新/下载/删除 |

### 4. 任务状态说明

- 🟦 **排队中** (in_queue)：任务已提交，等待处理
- 🔵 **生成中** (generating)：正在生成视频
- 🟢 **已完成** (done)：视频生成成功
- 🔴 **失败** (failed)：任务失败
- ⚪ **未找到** (not_found)：任务不存在
- ⚪ **已过期** (expired)：任务已过期

### 5. 操作功能

#### 5.1 查看详情 👁️
点击"查看详情"按钮，在模态框中显示完整的任务信息：
- 任务ID
- 状态和状态标签
- 创建时间和更新时间
- 输入图片预览
- 生成的视频（如果已完成）
- 支持下载视频和复制链接

#### 5.2 刷新状态 🔄
- 点击"刷新"按钮手动更新任务状态
- 自动查询火山引擎API获取最新状态
- 如果任务完成，会自动更新视频URL

#### 5.3 下载视频 ⬇️
- 仅对已完成的任务显示
- 点击直接下载生成的视频
- 支持在新标签页中打开视频

#### 5.4 删除任务 🗑️
- 从本地历史记录中删除任务
- 需要确认操作
- 注意：仅删除本地记录，不影响服务器端

### 6. 搜索功能

- 🔍 支持按任务ID搜索
- 实时筛选显示匹配的任务
- 可一键清空搜索条件

### 7. 自动状态更新

- ✅ 创建任务后自动保存到历史记录
- ✅ 轮询过程中自动更新任务状态
- ✅ 任务完成后自动保存视频URL
- ✅ 所有更新都会记录到本地存储

## 使用流程

### 步骤 1：创建任务

1. 在"创建任务"标签页上传图片和视频
2. 点击"开始生成动作模仿视频"
3. 任务提交成功后自动保存到历史记录
4. 系统自动开始轮询任务状态

### 步骤 2：查看任务列表

1. 切换到"任务列表"标签页
2. 查看所有历史任务
3. 使用搜索框快速查找特定任务

### 步骤 3：管理任务

1. **查看正在进行的任务**
   - 状态显示为"排队中"或"生成中"
   - 可以点击"刷新"按钮手动更新状态

2. **查看已完成的任务**
   - 状态显示为"已完成"
   - 可以下载视频或查看详情
   - 视频链接有效期为1小时

3. **删除不需要的任务**
   - 点击"删除"按钮
   - 确认后从历史记录中移除

## 技术特点

### 本地存储

- 使用 `localStorage` 存储任务历史
- 存储键：`motion_imitation_task_history`
- 最大保存 100 个任务记录
- 数据持久化，刷新页面不丢失

### 状态管理

- React Hooks 状态管理
- 自动同步任务状态
- 实时更新UI显示

### 数据结构

```javascript
{
  task_id: "string",           // 任务ID
  status: "string",            // 任务状态
  create_time: "ISO string",   // 创建时间
  update_time: "ISO string",   // 更新时间
  message: "string",           // 状态消息
  image_preview: "string",     // 图片预览URL或base64
  video_preview: "string",     // 视频预览URL
  video_url: "string"          // 生成的视频URL（完成后）
}
```

## 注意事项

### ⚠️ 重要提示

1. **视频链接有效期**
   - 生成的视频链接有效期为 **1小时**
   - 请及时下载重要的视频
   - 过期后需要重新生成

2. **本地存储限制**
   - 只保存最近 100 个任务
   - 超过限制会自动删除最旧的记录

3. **任务状态同步**
   - 当前任务会自动轮询更新状态
   - 历史任务需要手动点击"刷新"更新状态
   - 刷新操作会调用火山引擎API

4. **删除操作**
   - 仅删除本地历史记录
   - 不会取消或删除服务器端的任务
   - 删除后无法恢复

5. **图片预览**
   - 如果使用本地文件上传，会保存base64数据
   - Base64数据可能较大，建议使用URL方式

## 最佳实践

### 1. 任务管理建议

- 定期清理已完成的任务，避免占用存储空间
- 重要视频及时下载保存
- 使用任务ID搜索功能快速定位任务

### 2. 性能优化

- 使用URL方式上传文件（避免base64）
- 不要在历史记录中保存太多未完成的任务
- 定期清理失败或过期的任务

### 3. 故障排查

如果任务状态没有更新：
1. 检查 AccessKey 配置是否正确
2. 点击"刷新"按钮手动更新
3. 查看浏览器控制台的错误信息
4. 确认使用 Electron 桌面应用

## 相关文档

- [动作模仿功能设置指南](./MOTION_IMITATION_SETUP.md)
- [动作模仿API文档](./单图视频驱动.md)
- [常见问题说明](./MOTION_IMITATION_NOTICE.md)

## 更新日志

**v1.1.0** - 2025-10-13
- ✨ 新增任务列表功能
- ✨ 新增任务搜索功能
- ✨ 新增任务详情模态框
- ✨ 新增自动状态同步
- ✨ 新增批量任务管理
- 🔧 优化任务状态显示
- 🔧 优化用户界面体验

