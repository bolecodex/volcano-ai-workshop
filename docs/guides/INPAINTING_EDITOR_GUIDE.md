# 智能绘图(Inpainting)功能使用指南

## 功能简介

智能绘图(Inpainting涂抹编辑)功能允许用户通过涂抹、选区等方式建立重绘区域，按照提示词重新绘制指定内容。支持主体编辑、背景编辑和自定义区域编辑。

## 功能特点

- 🎨 **智能编辑**：通过mask图指定需要重绘的区域
- ✍️ **手绘工具**：内置Canvas画笔，可直接在图片上涂抹生成mask
- 🔄 **灵活输入**：支持本地文件上传和URL输入两种方式
- ⚙️ **参数调节**：可调整采样步数、文本引导强度等高级参数
- 🚀 **快速生成**：同步API，快速返回结果

## 使用步骤

### 1. 配置访问密钥

在开始使用之前，需要先在**设置页面**配置火山引擎的访问密钥：

1. 登录[火山引擎控制台](https://console.volcengine.com/)
2. 获取 AccessKeyId 和 SecretAccessKey
3. 在应用的设置页面中填入密钥信息
4. 确保您的账号已开通智能视觉服务权限

### 2. 准备图片

#### 原图要求
- **格式**：JPG、JPEG、PNG
- **大小**：最大 5 MB
- **分辨率**：最小 64×64，最大 4096×4096

#### Mask图要求
- **格式**：PNG格式
- **颜色**：单通道灰度图
  - 黑色区域(0)：保持原图不变
  - 白色区域(255)：需要重绘的区域
- **编码**：8bit PNG编码，不要嵌入ICC Profile

### 3. 上传图片

有两种方式上传图片：

#### 方式一：本地文件上传
1. 点击"原图"区域的文件选择按钮
2. 选择要编辑的图片
3. 对于Mask图，可以选择：
   - **上传Mask图片**：点击文件选择按钮上传已准备好的mask图
   - **手绘Mask**：点击"手绘Mask"按钮，使用画笔工具在图片上涂抹

#### 方式二：URL输入
1. 切换"使用URL"开关
2. 分别输入原图URL和Mask图URL
3. 确保URL可以被公网访问

### 4. 手绘Mask工具使用

如果选择手绘Mask：

1. 点击"或者手绘Mask"按钮进入绘制模式
2. 调整画笔大小（5-50px）
3. 在图片上用鼠标涂抹白色区域（需要重绘的部分）
4. 涂抹错误可点击"清除"按钮重新开始
5. 完成后点击"保存Mask"按钮

**提示**：白色涂抹区域将被AI重新生成，黑色区域保持原样。

### 5. 输入提示词

在提示词输入框中描述你想在涂抹区域生成的内容：

**示例提示词**：
- "一只小狗"
- "蓝天白云"
- "绿色草地"
- "红色跑车"
- "现代建筑"
- "森林背景"

**注意事项**：
- 提示词建议控制在100个中文字/英文单词以内
- 内容简洁准确，描述越具体效果越好
- 提示词会经过审核，请避免违规内容

### 6. 调整参数（可选）

#### 采样步数 (Steps)
- 范围：10-50
- 默认：25
- 说明：越大效果可能更好，但耗时更长

#### 文本引导强度 (Scale)
- 范围：1-20
- 默认：5
- 说明：影响文本描述对生成结果的影响程度

#### 随机种子 (Seed)
- 默认：-1（随机）
- 说明：使用相同正整数和参数可复现相同结果

### 7. 开始生成

1. 确认所有信息填写完整
2. 点击"开始生成"按钮
3. 等待生成完成（通常10-30秒）
4. 查看生成结果

### 8. 处理结果

生成完成后：
- 点击眼睛图标👁️预览图片
- 点击下载图标⬇️保存到本地
- 如果效果不满意，可调整提示词或参数重新生成

## 应用场景

### 1. 主体编辑
使用分割接口识别主体，对主体进行编辑：
- 更换服装颜色
- 添加饰品配件
- 改变发型发色

### 2. 背景编辑
识别背景，对背景进行重绘：
- 更换场景（室内→室外）
- 添加装饰元素
- 改变天气效果

### 3. 局部重绘
自定义选择任意区域：
- 添加新对象
- 修复缺陷
- 创意合成

## 常见问题

### 1. 提示"权限不足"
**原因**：
- 智能绘图服务未开通
- AccessKey权限不足
- AccessKey配置错误

**解决方案**：
- 访问火山引擎控制台申请服务权限
- 确认AccessKey具有"视觉智能"相关权限
- 重新检查AccessKey配置

### 2. 生成失败：输入图片前审核未通过 (错误码50411)
**原因**：输入图片包含敏感或违规内容

**解决方案**：更换图片

### 3. 生成失败：输出图片后审核未通过 (错误码50511)
**原因**：生成的图片包含敏感内容

**解决方案**：调整提示词，使用更合规的描述

### 4. 生成失败：输入文本审核未通过 (错误码50412/50413)
**原因**：提示词包含敏感词汇

**解决方案**：修改提示词内容

### 5. 生成效果不理想
**解决方案**：
- 调整mask区域大小和位置
- 使用更具体的提示词描述
- 增加采样步数(steps)
- 调整文本引导强度(scale)
- 尝试不同的随机种子

## 技术参数说明

### API接口信息
- **接口地址**：https://visual.volcengineapi.com
- **Action**：CVProcess
- **Version**：2022-08-31
- **req_key**：img2img_inpainting_edit_zi2i

### 请求参数
| 参数 | 类型 | 必选 | 说明 | 默认值 |
|-----|------|-----|------|--------|
| custom_prompt | string | 是 | 生成图像的提示词 | - |
| binary_data_base64 | Array | 二选一 | 图片Base64数组[原图, mask图] | - |
| image_urls | Array | 二选一 | 图片URL数组[原图URL, mask图URL] | - |
| steps | int | 否 | 采样步数 | 25 |
| scale | float | 否 | 文本引导强度(1-20) | 5 |
| seed | int | 否 | 随机种子(-1表示随机) | -1 |
| return_url | bool | 否 | 是否返回图片链接 | true |

### 返回参数
| 参数 | 类型 | 说明 |
|-----|------|------|
| binary_data_base64 | Array | 输出图片Base64数组 |
| image_urls | Array | 输出图片URL数组（24小时有效） |
| request_id | string | 请求ID |

## 最佳实践

### 1. Mask制作技巧
- **边缘处理**：Mask边缘尽量平滑，避免锯齿
- **区域大小**：重绘区域不宜过小，建议至少占图片10%以上
- **保留足够上下文**：周围保留一定原图区域，帮助AI理解场景

### 2. 提示词技巧
- **具体描述**：明确描述对象的特征、颜色、风格
- **场景关联**：考虑与原图的协调性
- **参考示例**：借鉴示例提示词的表达方式

### 3. 参数调优
- **首次尝试**：使用默认参数
- **精细化**：如果效果不满意，逐步调整steps和scale
- **批量生成**：使用不同seed生成多个版本，选择最佳效果

## 相关资源

- [火山引擎控制台](https://console.volcengine.com/)
- [智能视觉服务文档](https://www.volcengine.com/docs/6790/1104238)
- [API密钥管理](https://console.volcengine.com/iam/keymanage/)

## 更新日志

### v1.0.0 (2025-01-XX)
- ✨ 新增智能绘图功能
- ✨ 支持手绘Mask工具
- ✨ 支持本地文件和URL两种输入方式
- ✨ 支持参数自定义调节
- ✨ 集成火山引擎视觉智能API

## 反馈与支持

如有问题或建议，请通过以下方式联系我们：
- 提交Issue到项目仓库
- 访问火山引擎技术支持
- 发送邮件至技术支持邮箱

