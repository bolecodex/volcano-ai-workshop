# 智能搜图功能使用指南

## 概述

智能搜图功能集成了火山引擎的图像向量化 API，支持以图搜图、以文搜图和混合搜索等多种方式，利用语义理解技术实现智能图像检索。

## API 文档参考

- **API 端点**: `https://ark.cn-beijing.volces.com/api/v3/embeddings/multimodal`
- **官方文档**: 火山方舟 - 图像向量化 API

## 功能特性

### 1. 多模态搜索支持

- **以图搜图**: 上传或输入图片 URL 进行搜索
- **以文搜图**: 使用文字描述搜索相似图片
- **混合搜索**: 结合图片和文字进行更精确的搜索
- **视频支持**: 支持视频输入进行搜索（需要模型支持）

### 2. 向量数据库管理

- 添加图片到本地向量数据库
- 为每个图片添加名称和描述
- 查看和管理向量库中的所有图片
- 支持删除单个或批量清空

### 3. 相似度计算

- 使用余弦相似度算法计算图片之间的相似度
- 直观的相似度百分比显示
- 按相似度从高到低排序展示结果

### 4. 搜索历史

- 自动记录每次搜索
- 保留最近 20 条搜索记录
- 显示搜索时间、模式和结果数量

## 使用步骤

### 第一步：配置 API Key

1. 点击侧边栏的"设置"进入设置页面
2. 输入你的火山引擎 ARK API Key
3. 点击"测试连接"确认 API 可用
4. API Key 会自动保存到本地

### 第二步：建立向量数据库

在开始搜索之前，需要先向向量数据库中添加图片：

1. 进入"智能搜图"页面
2. 切换到"向量库"标签页
3. 点击"添加图片"按钮
4. 输入图片名称和描述（可选）
5. 上传图片或输入图片 URL
6. 点击"添加"按钮

系统会自动调用向量化 API 生成图片的向量表示并保存到本地数据库。

### 第三步：执行搜索

#### 以图搜图模式

1. 切换到"搜索"标签页
2. 选择"以图搜图"模式
3. 上传要搜索的图片或输入图片 URL
4. 点击"开始搜索"按钮
5. 查看搜索结果和相似度

#### 以文搜图模式

1. 选择"以文搜图"模式
2. 在文本框中输入描述
3. 点击"开始搜索"按钮
4. 查看搜索结果

#### 混合搜索模式

1. 选择"混合搜索"模式
2. 同时上传图片和输入文字描述
3. 点击"开始搜索"按钮
4. 系统会综合图片和文字信息进行搜索

## 配置选项

### 模型选择

- **doubao-embedding-vision-250615** (推荐)
  - 支持不限数量的文本、图片和视频混排输入
  - 更强大的语义理解能力
  
- **doubao-embedding-vision-250328** (旧版本)
  - 仅支持 1段文本、1段图片、或 1段图片+1段文本

### 向量维度

- **1024维**: 较低的存储和计算需求
- **2048维**: 更高的精度和更好的搜索效果（推荐）

### 编码格式

- **Float**: 浮点数格式（推荐）
- **Base64**: Base64 编码格式

## 输入要求

### 图片要求

- **格式**: JPEG、PNG、WebP、BMP、TIFF、ICO、DIB、ICNS、SGI、JPEG2000
- **大小**: 单张图片小于 10 MB
- **像素**: 总像素不大于 3600万
- **宽高比**: 在范围 [1/100, 100] 之间

### 视频要求

- **格式**: MP4、AVI、MOV（需小写）
- **大小**: 单视频文件在 50MB 以内
- **编码**: 支持 Base64 编码或 URL

### 文本要求

- **编码**: UTF-8
- **长度**: 不超过 100,000 字节
- **Token**: 不超过 8k tokens（建议不超过 4096 tokens）

## 相似度说明

搜索结果使用余弦相似度算法计算，结果范围在 0-1 之间：

- **0.9 - 1.0**: 非常相似（绿色进度条）
- **0.7 - 0.9**: 比较相似（蓝色进度条）
- **0.0 - 0.7**: 相似度较低（黄色进度条）

## Token 计费说明

每次搜索会显示 Token 使用情况：

- **图片 Token**: 图片内容产生的 token 量
- **文本 Token**: 文本内容产生的 token 量
- **总 Token**: 本次请求消耗的总 token 数

注意：传入图片或视频时，会生成少量预设文本 token，产生额外的计费。

## 数据存储

- **向量数据库**: 存储在本地浏览器的 localStorage 中
- **搜索历史**: 存储在本地，最多保留 20 条
- **图片预览**: 使用 Base64 格式存储（注意存储空间限制）

## 常见问题

### 1. 为什么搜索结果为空？

请确保：
- 已经在向量数据库中添加了图片
- API Key 配置正确
- 网络连接正常

### 2. 如何提高搜索准确度？

- 使用高质量的图片
- 添加详细的文字描述（混合搜索模式）
- 选择 2048 维向量
- 在向量库中添加更多相关图片

### 3. 向量数据库存储在哪里？

向量数据库存储在浏览器的 localStorage 中，数据仅保存在本地，不会上传到服务器。

### 4. 如何备份向量数据库？

目前向量数据库存储在本地，建议：
- 定期导出重要图片
- 记录图片的来源 URL
- 考虑使用云端存储方案

### 5. 支持哪些图片格式？

支持常见的图片格式，包括：
- JPEG/JPG
- PNG
- WebP
- BMP
- TIFF
- 以及其他格式（详见输入要求）

## 技术实现

### 核心流程

1. **图片向量化**
   ```
   图片 → Base64编码 → 向量化API → 向量表示（2048维）
   ```

2. **相似度计算**
   ```
   查询向量 × 数据库向量 → 余弦相似度 → 排序输出
   ```

3. **数据存储**
   ```
   向量数据 + 元数据 → localStorage → 持久化存储
   ```

### API 调用示例

```javascript
// 构建请求
const requestBody = {
  model: 'doubao-embedding-vision-250615',
  encoding_format: 'float',
  dimensions: 2048,
  input: [
    {
      type: 'image_url',
      image_url: {
        url: 'https://example.com/image.jpg'
      }
    },
    {
      type: 'text',
      text: '图片的文字描述'
    }
  ]
};

// 调用API
const response = await fetch('https://ark.cn-beijing.volces.com/api/v3/embeddings/multimodal', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${apiKey}`
  },
  body: JSON.stringify(requestBody)
});

// 获取向量结果
const data = await response.json();
const embedding = data.data.embedding; // 2048维向量
```

## 性能优化建议

1. **图片大小**: 建议压缩图片后再上传，减少网络传输时间
2. **向量维度**: 根据精度需求选择合适的维度
3. **批量操作**: 一次性添加多个图片时，可以分批处理避免超时
4. **本地缓存**: 充分利用本地存储，减少重复的 API 调用

## 更新日志

- **v1.0.0** (2025-10-14)
  - 初始版本发布
  - 支持图片、文本、视频多模态输入
  - 实现本地向量数据库管理
  - 添加搜索历史功能
  - 支持余弦相似度计算

## 参考资料

- [火山引擎 - 图像向量化 API 文档](https://www.volcengine.com/docs/82379/1298454)
- [火山方舟大模型服务平台](https://ark.cn-beijing.volces.com)
- [向量检索原理与实践](https://en.wikipedia.org/wiki/Cosine_similarity)

## 支持与反馈

如有问题或建议，请通过以下方式联系：
- 提交 Issue 到项目仓库
- 查看官方文档获取更多信息
- 联系技术支持团队

---

**注意**: 本功能依赖火山引擎的图像向量化 API 服务，使用前请确保已开通相关服务并获取有效的 API Key。


